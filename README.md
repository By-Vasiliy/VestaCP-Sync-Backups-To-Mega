VestaCP загрузка бэкапов в облако MEGA
====

С помощью данного скрипта вы сможете автоматизировать загрузку бэкапов в облако MEGA, бесплатно предоставляющие 50 GiB для пользователей. Также есть платные тарифы.

Скрипт принимает один параметр, количество бэкапов на одного пользователя. Данное число нужно рассчитывать в ручную так как на данный момент скрипт не определяет количество свободного места в облаке, и просто удаляет бэкапы если их число превышает заданное!

## Зависимости ##

Для работы скрипта необходимо установить [MegaTools](https://megatools.megous.com/)

Скрипт установки под Ubuntu: install-megatools.sh (где его искать? смотрите файлы в git репозитории)

*Также данный скрипт можно установить под любую Linux OS, но инструкция написана  под Ubuntu 14.04 и не проверялась под другими системами. Так что если вы захотите плясок  бубном и у вас всё получится можете составить или дополнить инструкцию.*

**Проверка установился ли MegaTools:** От любого пользователя выполните команду ***megareg*** и
если результат такой

```
ERROR: You must specify either --register or --verify option
```
то всё хорошо, а если такой

```
megareg: command not found
```
то всё плохо **MegaTools** не установился ищите проблему (Почти всегда всё ставится без плясок с бубном, но могут встретятся проблемы их я описывать не буду).


## Установка скрипта ##

Необходимо разместить скрипт (v-sync-backups-to-mega) в папке **/usr/local/vesta/bin/** и в самом файле изменить пару строк:

<server name> —  это название папки в которую будут загружаться файлы. (пример: vps1 — но лучше что нибудь вразумительное без пробелов).

<server prefix> — это просто префикс, добавится перед именем сервера (удобно если в один аккаунт грузится бэкапы с 2-3 серверов одного и того же проекта, если не нужно сделайте пустым).

После всех изменений выполняем команды:

```
chmod 770 /usr/local/vesta/bin/v-sync-backups-to-mega
chown root:root /usr/local/vesta/bin/v-sync-backups-to-mega
```


Далее необходимо создать файл **.megarc** в домашней директории root (/root/.megarc) со следующими данными:


```

[Login]
Username = Your_Mega_Username
Password = Your_Mega_Password

```
**Проверяем результат:** От имени root выполняем команду ***megals***, должно вывести что-то похожее:


```
/Contacts
/Inbox
/Root
/Trash

```

Если в результате ошибка то неправильно заполнен конфигурационный файл **.megarc**  либо вы выполнили команду не от имени root.


Далее через панель управления Vesta создаём крон задание с командой:


```
sudo /usr/local/vesta/bin/v-sync-backups-to-mega С%

```
**С% ** - Целое число бэкапов для 1 пользователя хранимое в облаке, по стандарту если не выставить число установлено 21, если у вас мало пользователей в панели и размеры бэкапов не превышают 500-800 MiB то это вполне приемлемая цифра. Но рассчитывать её желательно индивидуально и периодически проверять облако.

Всем удачи!
===